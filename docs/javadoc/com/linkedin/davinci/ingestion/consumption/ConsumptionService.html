<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>ConsumptionService (venice API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ConsumptionService (venice API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.ingestion.consumption</a></div>
<h2 title="Interface ConsumptionService" class="title">Interface ConsumptionService&lt;MESSAGE_QUEUE,&#8203;MESSAGE&gt;</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>MESSAGE_QUEUE</code> - Type of the message queue where data is consumed. For example, if data is consuming from Kafka,
                       this type could be <code>TopicPartition</code>.</dd>
<dd><code>MESSAGE</code> - Type of consumed data. For example, in the Kafka case, this type could be <code>ConsumerRecords</code></dd>
</dl>
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="kafka/KafkaConsumptionService.html" title="class in com.linkedin.davinci.ingestion.consumption.kafka">KafkaConsumptionService</a></code></dd>
</dl>
<hr>
<pre>public interface <span class="typeNameLabel">ConsumptionService&lt;MESSAGE_QUEUE,&#8203;MESSAGE&gt;</span></pre>
<div class="block">This interface is an abstraction provided to StoreIngestionTask and it allows its users to start/stop consuming a
 given message queue. It should be a singleton object, meaning one per Venice server (storage node).

 All methods this interface provides are non-blocking async methods for below reasons:

  1. In most (if not all) cases, the only two ways to handle failures when calling any API on interface is
     to retry or let the caller throw an exception to fail out loud. Because, for example, when this interface is used
     in our Venice server storage node to consume from Kafka topic partitions, say, {@link this#startConsuming} fails. What
     could be done here to handle its failure? Either retry or fail the whole ingestion task. Retry can happen inside
     the implementation of this interface and reported as metrics that eventually trigger alerts. On the other hand, caller
     can store the returned <code>CompletableFuture</code> and revisit them later, if any one of them is completed with an
     exception, the caller thread can look at the exception type and decide whether to fail out loud.
     Hence this non-blocking async design allows API users to handle both situations (retry and fail out loud).

  2. Flexibility. Specifically, users can easily convert a non-blocking async method to a blocking one by waiting on the
     <code>CompletableFuture</code> but not the other way around.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#startBatchConsuming(java.util.Map)">startBatchConsuming</a></span>&#8203;(java.util.Map&lt;<a href="MessageQueueOffset.html" title="class in com.linkedin.davinci.ingestion.consumption">MessageQueueOffset</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&gt;,&#8203;<a href="ConsumedDataReceiver.html" title="interface in com.linkedin.davinci.ingestion.consumption">ConsumedDataReceiver</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE</a>&gt;&gt;&nbsp;queueOffsetConsumedDataReceiverMap)</code></th>
<td class="colLast">
<div class="block">A batch version of <a href="#startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)"><code>startConsuming(MESSAGE_QUEUE, com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver&lt;MESSAGE&gt;, long)</code></a>.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)">startConsuming</a></span>&#8203;(<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&nbsp;queue,
              <a href="ConsumedDataReceiver.html" title="interface in com.linkedin.davinci.ingestion.consumption">ConsumedDataReceiver</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE</a>&gt;&nbsp;consumedDataReceiver,
              long&nbsp;startingOffset)</code></th>
<td class="colLast">
<div class="block">Start consuming a message queue at an given offset.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#stopConsuming(MESSAGE_QUEUE)">stopConsuming</a></span>&#8203;(<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&nbsp;queue)</code></th>
<td class="colLast">
<div class="block">Stop consuming a message queue.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="startConsuming(java.lang.Object,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)">
<!--   -->
</a><a id="startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>startConsuming</h4>
<pre class="methodSignature">java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;&nbsp;startConsuming&#8203;(<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&nbsp;queue,
                                                                           <a href="ConsumedDataReceiver.html" title="interface in com.linkedin.davinci.ingestion.consumption">ConsumedDataReceiver</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE</a>&gt;&nbsp;consumedDataReceiver,
                                                                           long&nbsp;startingOffset)</pre>
<div class="block">Start consuming a message queue at an given offset. This method must be non-blocking. In other words, it must return immediately.

 If consumption on this queue has already been started, this method moves the consuming offset to {@param startingOffset}
 and start consuming at that offset. IOW, it changes the consumption offset.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>queue</code> - Queue to start consuming from.</dd>
<dd><code>consumedDataReceiver</code> - Where all consumed data is written to.</dd>
<dd><code>startingOffset</code> - Consumption starting offset.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A callback that is invoked when the consumption actually starts. If consumption fails to start, users waiting
         on this callback will get an exception which contains failure context.
         Note that the <code>CompletableFuture</code> should guarantee to be completed by a fixed amount of time. This
         guaranteed upper bound must be provided by its implementations.</dd>
</dl>
</li>
</ul>
<a id="startBatchConsuming(java.util.Map)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>startBatchConsuming</h4>
<pre class="methodSignature">java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;&nbsp;startBatchConsuming&#8203;(java.util.Map&lt;<a href="MessageQueueOffset.html" title="class in com.linkedin.davinci.ingestion.consumption">MessageQueueOffset</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&gt;,&#8203;<a href="ConsumedDataReceiver.html" title="interface in com.linkedin.davinci.ingestion.consumption">ConsumedDataReceiver</a>&lt;<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE</a>&gt;&gt;&nbsp;queueOffsetConsumedDataReceiverMap)</pre>
<div class="block">A batch version of <a href="#startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)"><code>startConsuming(MESSAGE_QUEUE, com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver&lt;MESSAGE&gt;, long)</code></a>. This method could be useful when there are a large number of message queues
 (e.g. topic partitions) that need to be consumed in a very short period of time. This situation occurs, for example,
 when a storage node starts up.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>queueOffsetConsumedDataReceiverMap</code> - Self-explanatory.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Same as the return param in <a href="#startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)"><code>startConsuming(Object, ConsumedDataReceiver, long)</code></a>.
         Note that the <code>CompletableFuture</code> should guarantee to be completed by a fixed amount of time. This
         guaranteed upper bound must be provided by its implementations.</dd>
</dl>
</li>
</ul>
<a id="stopConsuming(java.lang.Object)">
<!--   -->
</a><a id="stopConsuming(MESSAGE_QUEUE)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>stopConsuming</h4>
<pre class="methodSignature">java.util.concurrent.CompletableFuture&lt;java.lang.Exception&gt;&nbsp;stopConsuming&#8203;(<a href="ConsumptionService.html" title="type parameter in ConsumptionService">MESSAGE_QUEUE</a>&nbsp;queue)</pre>
<div class="block">Stop consuming a message queue. This method must be non-blocking. In other words, it must return immediately.
 Calling this method makes the <a href="ConsumptionService.html" title="interface in com.linkedin.davinci.ingestion.consumption"><code>ConsumptionService</code></a> object forget about this queue completely. Calling this
 method before calling <a href="#startConsuming(MESSAGE_QUEUE,com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver,long)"><code>startConsuming(MESSAGE_QUEUE, com.linkedin.davinci.ingestion.consumption.ConsumedDataReceiver&lt;MESSAGE&gt;, long)</code></a> is a no-op.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>queue</code> - Queue to stop consuming from.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A callback that is invoked when the consumption actually stopped. If consumption fails to stop, users waiting
         on this callback will get an exception which contains failure context.
         Note that the <code>CompletableFuture</code> should guarantee to be completed by a fixed amount of time. This
         guaranteed upper bound must be provided by its implementations.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
